---
title: "Effects of FDI on Inequality Code"
output: html_document
date: "2023-03-09"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(plm)
library(DescTools)
library(dineq)
library(AER)
library(stargazer)
library(GGally)
library(dplyr)
library(ggplot2)
library(sjPlot)
library(sjmisc)
library(marginaleffects)
library(rstatix)

master <- read.csv("raw data.csv", fileEncoding = "UTF-8")

```


```{r}

#Gini calculation from quintiles
quintiles <- master[,11:15]

for (i in 1:nrow(quintiles)){
master$gini[i]  <- gini.wtd(quintiles[i,])

} 


```

```{r}

#Natural log-transforming skewed variables
master$log_cap <- log(master$Total.registered.capital..Mill..USD.)
master$log_pro <- log(master$Number.of.projects)
master$log_income <- log(master$Income)
master$log_ent <- log(master$Number.of.Enterprises)
master$log_rur <- log(master$RuralPop)
master$log_urb <- log(master$UrbanPop)

```

```{r}


# F-test for gini fixed effects and pooled-OLS
print(pFtest(fe_cap_gini,pool_cap_gini), digits = 3)

# F-test for ratio fixed effects and pooled-OLS
print(pFtest(fe_cap_ratio,pool_cap_ratio), digits = 3)

# Hausman test for gini fixed and random effects
print(phtest(fe_cap_gini,re_cap_gini), digits = 3)

# Hausman test for Ratio fixed and random effects
print(phtest(fe_cap_ratio,re_cap_ratio), digits = 3)


```

```{r}
#Covariate pairwise correlations
covariates <- master[,c("log_income","log_cap","UrbanPercent", "gini", "Ratio", "Trained.Labour.Rate", "Employment.Rate", "Governance.Score")]

ggpairs(covariates)
```


```{r}
#Descriptive statistics

  get_summary_stats(covariates, type = "common")                    

```





```{r}
# Capital inequality
fe_cap_gini <- plm(gini ~ log_cap + log_income + Trained.Labour.Rate + Employment.Rate + Governance.Score + UrbanPercent, data = master, index = c("Province", "Year"), model = "within", effect = "twoways")

fe_cap_ratio <- plm(Ratio ~ log_cap + log_income + Trained.Labour.Rate + Employment.Rate + Governance.Score + UrbanPercent, data = master, index = c("Province", "Year"), model = "within", effect = "twoways")

# Cluster-robust standard errors
se_gini1 <- coeftest(fe_cap_gini, vcov=vcovHC(fe_cap_gini, cluster = "group", type="HC1"))

se_ratio2 <- (coeftest(fe_cap_ratio, vcov=vcovHC(fe_cap_ratio, cluster = "group", type="HC1")))

stargazer(fe_cap_gini, fe_cap_ratio, type = "text", column.labels = c("Model 1", "Model 2"), title = "Accumulated FDI Capital and Inequality Measures", se = list(se_gini1[,2],se_ratio2[,2]))

```

```{r}
# Graphs for Models 1 and 2

ggplot(master, mapping = aes(log_cap, gini)) + geom_point() + geom_smooth(method = "lm")

ggplot(master, mapping = aes(log_cap, Ratio)) + geom_point() + geom_smooth(method = "lm")


```


```{r}
# Model for interaction between FDI and trained labour rates

int_cap_gini <- plm(gini ~  log_cap + log_cap*Trained.Labour.Rate + Trained.Labour.Rate + UrbanPercent + log_income + Employment.Rate + Governance.Score, data = master,index = c("Province", "Year"), model = "within", effect = "twoways")

int_cap_ratio <- plm(Ratio ~  log_cap + log_cap*Trained.Labour.Rate + Trained.Labour.Rate + log_income + UrbanPercent + Employment.Rate + Governance.Score, data = master, index = c("Province", "Year"), model = "within", effect = "twoways")

# Cluster-robust standard errors
se_gini3 <- coeftest(int_cap_gini, vcov=vcovHC(int_cap_gini, cluster = "group", type="HC1"))

se_ratio4 <- coeftest(int_cap_ratio, vcov=vcovHC(int_cap_ratio, cluster = "group", type="HC1"))

stargazer(int_cap_gini, int_cap_ratio, type = "text", column.labels = c("Model 3", "Model 4"), title = "Interaction of FDI and Trained Labour Rates and Inequality", se = list(se_gini3[,2], se_ratio4[,2]))
```


```{r}
# Changes in slope with interaction terms

plot_model(int_cap_ratio, type ="int", terms = c("log_cap", "Trained.Labour.Rate"))

plot_model(int_cap_gini, type ="int", terms = c("log_cap", "Trained.Labour.Rate"))

```


```{r}
# Marginal effects plot from ratio interaction model with clustered standard errors
marg_ef_ratio <- plot_slopes(int_cap_ratio, variables = "log_cap", condition = "Trained.Labour.Rate", vcov = vcovHC(int_cap_ratio, cluster = "group", type="HC1"), draw = TRUE)

marg_ef_ratio +labs(y= "Marginal Effect of FDI on Ratio Measure of Inequality", x = "Trained Labour Rate")

```



```{r}
# Marginal effects plot from Gini interaction model with clustered standard errors
marg_ef_gini <- plot_slopes(int_cap_gini, variables = "log_cap", condition = "Trained.Labour.Rate", vcov = vcovHC(int_cap_gini, cluster = "group", type="HC1"), draw = TRUE)

marg_ef_gini +labs(y= "Marginal Effect of FDI on Gini Coefficient", x = "Trained Labour Rate")

```



```{r}
# Gini coefficient twoway random effects and pooled OLS
re_cap_gini <- plm(gini ~ log_cap + log_income + Trained.Labour.Rate + Employment.Rate + Governance.Score + UrbanPercent, data = master, index = c("Province", "Year"), model = "random", effect = "twoways")


pool_cap_gini <- plm(gini ~ log_cap + log_income + Trained.Labour.Rate + Employment.Rate + Governance.Score + UrbanPercent, data = master, model = "pooling")


se_gini_re <- coeftest(re_cap_gini, vcov=vcovHC(re_cap_gini, cluster = "group", type="HC1"))


stargazer(fe_cap_gini, re_cap_gini, pool_cap_gini, type = "text", title = "Accumulated FDI Capital and Provincial Gini", column.labels = c("Fixed effects", "Random effects", "Pooled-OLS"), se = list(se_gini1[,2],se_gini_re[,2]),align = TRUE)
```





```{r}

# Ratio measure twoway random effects and pooled OLS

re_cap_ratio <- plm(Ratio ~ log_cap + log_income + Trained.Labour.Rate + Employment.Rate + Governance.Score + UrbanPercent, data = master, index = c("Province", "Year"), model = "random", effect = "twoways")

pool_cap_ratio <- plm(Ratio ~ log_cap + log_income + Trained.Labour.Rate + Employment.Rate + Governance.Score + UrbanPercent, data = master, model = "pooling")

se_ratio_re <- coeftest(re_cap_gini, vcov=vcovHC(re_cap_gini, cluster = "group", type="HC1"))

stargazer(fe_cap_ratio, re_cap_ratio, pool_cap_ratio, type = "text", title = "Accumulated FDI Capital and Provincial Ratio Measure", column.labels = c("Fixed effects", "Random effects", "Pooled-OLS"), se = list(se_ratio2[,2], se_ratio_re[,2]), align = TRUE)


```



```{r}

# Interaction model two-way random effects and pooled OLS for Gini coefficient

int_re_cap_gini <- plm(gini ~  log_cap + Trained.Labour.Rate*log_cap + Trained.Labour.Rate + UrbanPercent + log_income + Employment.Rate + Governance.Score, data = master,index = c("Province", "Year"), model = "random", effect = "twoways")


int_pool_cap_gini <- plm(gini ~ log_cap + Trained.Labour.Rate*log_cap + Trained.Labour.Rate + UrbanPercent + log_income + Employment.Rate + Governance.Score, data = master, model = "pooling")

se_int_gini_re <- coeftest(int_re_cap_gini, vcov=vcovHC(int_re_cap_gini, cluster = "group", type="HC1"))



stargazer(int_cap_gini, int_re_cap_gini, int_pool_cap_gini, type = "text", title = "Interaction Models and Provincial Gini Measure", column.labels = c("Fixed effects", "Random effects", "Pooled-OLS"), se = list(se_gini3[,2], se_int_gini_re[,2]), align = TRUE)

```




```{r}

# Interaction model two-way random effects and pooled OLS for ratio measure


int_re_cap_ratio <- plm(Ratio ~  log_cap + Trained.Labour.Rate*log_cap + Trained.Labour.Rate + UrbanPercent + log_income + Employment.Rate + Governance.Score, data = master,index = c("Province", "Year"), model = "random", effect = "twoways")

int_pool_cap_ratio <- plm(Ratio ~  log_cap + Trained.Labour.Rate*log_cap + Trained.Labour.Rate + UrbanPercent + log_income + Employment.Rate + Governance.Score, data = master, model = "pooling")

se_int_ratio_re <- coeftest(int_re_cap_ratio, vcov=vcovHC(int_re_cap_ratio, cluster = "group", type="HC1"))



stargazer(int_cap_ratio, int_re_cap_ratio, int_pool_cap_ratio, type = "text", title = "Accumulated FDI Capital and Provincial Ratio Measure", column.labels = c("Fixed effects", "Random effects", "Pooled-OLS"), se = list(se_ratio4[,2], se_int_ratio_re[,2]), align = TRUE)
```


